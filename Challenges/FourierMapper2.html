
<div  style="text-align:center;font-family:consolas">
<center><h1>Fourier transform analysis of speculative ticket flow</h1>
<h2>is it possible to extract periodic patterns from something like ticket influx?</h2></center>
<canvas id="myCanvas" >
		
</canvas>
</div>
<br>
<div id = "results" style="text-align:center;font-family:consolas">

</div>
<script>
//Find Center Of Samples
var Samples = [
12,
24,
22,
23,
21,
19,
14,
13,
26,
20,
24,
21,
20,
10,
12,
25,
19,
20,
20,
21,
12,
12,
24,
22,
23,
21,
19,
14,
13,
26,
20,
24,
21,
20,
10,
12,
25,
19,
20,
20,
21,
12,
12,
24,
22,
23,
21,
19,
14,
13,
26,
20,
24,
21,
20,
10,
12,
25,
19,
20,
20,
21,
12,
12,
24,
22,
23,
21,
19,
14,
13,
26,
20,
24,
21,
20,
10,
12,
25,
19,
20,
20,
21,
12,
12,
24,
22,
23,
21,
19,
14,
13,
26,
20,
24,
21,
20,
10,
12,
25,
19,
20,
20,
21,
12,
12,
24,
22,
23,
21,
19,
14,
13,
26,
20,
24,
21,
20,
10,
12,
25,
19,
20,
20,
21,
12
]

var TestFrequency = 1
var hasRunInverse = false;
const TAU = Math.PI*2;
var scale = 200;
const canvas = document.getElementById("myCanvas")
const ctx = canvas.getContext("2d");
canvas.width = scale*6;
canvas.height = scale*4;
var average = 0;
const GoodFrequencies = [];
function GetAverage(){
	average = 0;
	for(var i = 0; i < Samples.length;i++){
		average+=Samples[i]
	}	
	average=average/Samples.length
}
function Fourier(samples, testFreq, color="#00FF00", centercolor="#FF0000", size=10){
	var sampleSumX=0;
	var sampleSumY=0;
	for(var i = 0; i < samples.length;i++){
		var t = i/samples.length; 
		var angle = t * TAU * testFreq;
		var testX = Math.cos(angle);
		var testY = Math.sin(angle);
		var sampleX = testX*(samples[i]-average);
		var sampleY = testY*(samples[i]-average);
		sampleSumX+=sampleX;
		sampleSumY+=sampleY;
		drawPoint(sampleX,sampleY,color,size)
	}
	var centerX=sampleSumX / samples.length;
	var centerY=sampleSumY / samples.length;
	var distance = 	Math.sqrt(Math.pow(centerX,2)+Math.pow(centerY,2))
	drawPoint(0,0,"#0099FF")
	drawPoint(centerX,centerY,centercolor,size)
	var angle = Math.atan2(centerX, centerY); 
	angle = angle * (180 / Math.PI);
	console.log("["+testFreq+"] : ["+distance+" : "+angle+"]")
	return [distance, angle]
}

function stepFrequency(){
	if(TestFrequency>=Samples.length){
		rebuildFrequency()
		console.log(GoodFrequencies);
		return
	}
	
	ctx.fillStyle = "#000000";
	ctx.fillRect(0, 0, canvas.width, canvas.height)
	var distance = Fourier(Samples,TestFrequency)
	var delay = 100;
	if(distance[0]>0.5){
		GoodFrequencies.push([TestFrequency,distance]);
		document.getElementById("results").innerHTML+=""+[TestFrequency,distance].toString()+"<br>"
		delay=1000;
	}
	if(TestFrequency<1){
		TestFrequency=TestFrequency*1.2;
	}else{
		TestFrequency=Math.round(TestFrequency+1)
	}
	
	setTimeout(stepFrequency,delay);
	
	
}
function drawPoint(x,y,color,size=10){

	var thisX = (x*scale/5)+(scale*3);
	var thisY = (y*scale/5)+(scale*2);
	ctx.beginPath();
	ctx.arc(thisX, thisY, size, 0, 2 * Math.PI);
	ctx.fillStyle = color;
	ctx.fill();
}
var Prediction = []
function rebuildFrequency(factor=3){
	ctx.fillStyle = "#000000";
	ctx.fillRect(0, 0, canvas.width, canvas.height)
	Prediction = []
	var amt = Samples.length
	for(var i = 0; i < amt;i++){
		var bucket = 0
		for(var j = 0;j<GoodFrequencies.length;j++){
			bucket+=Math.sin(GoodFrequencies[j][0]*((i/amt)+(GoodFrequencies[j][1][1]/180)))*GoodFrequencies[j][1][0]
		}
		bucket=bucket*factor/GoodFrequencies.length
		Prediction.push(bucket+average)
	}
	ctx.fillStyle = "#00ff00";
	for(var i =0;i<Samples.length;i++){
		ctx.fillRect((i*10)+20,canvas.height-(Samples[i]*20), 10, Samples[i]*20)
	}
	ctx.fillStyle = "#00aaff99";
	for(var i =0;i<Prediction.length;i++){
		ctx.fillRect((i*10)+20,canvas.height-(Prediction[i]*20), 10, Prediction[i]*20)
	}
}
document.getElementById("results").innerHTML+=""+Samples.toString()+"<br>"
GetAverage()
stepFrequency();
</script>
