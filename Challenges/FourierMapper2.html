
<div  style="text-align:center;font-family:consolas">
<center><h1>Fourier transform analysis of speculative ticket flow</h1>
<h2>is it possible to extract periodic patterns from something like ticket influx?</h2></center>
<div><button onclick="repaintFrequency(0)">Normal view</button><button onclick="repaintFrequency(1)">Direction view</button><button onclick="repaintFrequency(2)">Error view</button></div>
<canvas id="myCanvas" >
		
</canvas>
</div>
<br>
<div id = "results" style="text-align:center;font-family:consolas">

</div>
<script>
//Find Center Of Samples
var Samples = [
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21,
24,
22,
23,
21,
19,
26,
20,
24,
21,
20,
25,
19,
20,
20,
21
]

var TestFrequency = 0.01
var hasRunInverse = false;
const TAU = Math.PI*2;
var scale = 200;
const canvas = document.getElementById("myCanvas")
const ctx = canvas.getContext("2d");
canvas.width = scale*64;
canvas.height = scale*4;
var average = 0;
var GoodFrequencies = [];
function GetAverage(){
	average = 0;
	for(var i = 0; i < Samples.length;i++){
		average+=Samples[i]
	}	
	average=average/Samples.length
}
function Fourier(samples, testFreq, color="#00FF00", centercolor="#FF0000", size=5){
	var sampleSumX=0;
	var sampleSumY=0;
	for(var i = 0; i < samples.length;i++){
		var t = i/samples.length; 
		var angle = t * TAU * testFreq;
		var testX = Math.cos(angle);
		var testY = Math.sin(angle);
		var sampleX = testX*(samples[i]-average);
		var sampleY = testY*(samples[i]-average);
		sampleSumX+=sampleX;
		sampleSumY+=sampleY;
		drawPoint(sampleX,sampleY,color,size)
	}
	var centerX=sampleSumX / samples.length;
	var centerY=sampleSumY / samples.length;
	var distance = 	Math.sqrt(Math.pow(centerX,2)+Math.pow(centerY,2))
	drawPoint(0,0,"#0099FF")
	drawPoint(centerX,centerY,centercolor,size)
	var angle = Math.atan2(centerX, centerY); 
	angle = angle * (180 / Math.PI);
	console.log("["+testFreq+"] : ["+distance+" : "+angle+"]")
	return [distance, angle]
}
var AllFrequencies=[]
var numberOfWaves = 3
var lastHeight = 0;
var lastFound =[]
var lastHarmonicHeight=0;
var lastHarmonicFound=[];
function stepFrequency(){
	if(TestFrequency>=Samples.length/1.5){
		GoodFrequencies = []
		AllFrequencies.sort(function(a, b) {
			return b[1][0] - a[1][0];
		});
		for(var i = 0; i<numberOfWaves && i < AllFrequencies.length;i++){
			GoodFrequencies.push(AllFrequencies[i])
			document.getElementById("results").innerHTML+=""+AllFrequencies[i].toString()+"<br>"
		}
		rebuildFrequency()
		console.log(GoodFrequencies);
		return
	}
	
	ctx.fillStyle = "#000000";
	ctx.fillRect(0, 0, canvas.width, canvas.height)
	
	var distance = Fourier(Samples,TestFrequency)
	var delay = 0;
	if(distance[0]>lastHeight){
		lastHeight=distance[0]
		lastFound=[TestFrequency,distance]
		console.log(lastFound)
	}else{
		if(lastHarmonicHeight<lastHeight){
			lastHarmonicFound=lastFound
			lastHarmonicHeight=lastHeight
		}else{			
			if(lastHarmonicFound!=[]){
				console.log(lastHarmonicFound)
				AllFrequencies.push(lastHarmonicFound);
			lastHarmonicFound=[];
			lastHarmonicHeight=0
			}
		}
		
		lastHeight=0
		lastFound=[]
	}
	
	
	if(TestFrequency<1){
		TestFrequency=Math.round((TestFrequency+0.05)*100)/100;
	}else{
		TestFrequency=Math.round((TestFrequency+1/*0.1*/)/*100*/)/*100*/
	}
	
	setTimeout(stepFrequency,delay);
	
	
}
function drawPoint(x,y,color,size=10){

	var thisX = (x*scale/5)+(scale*3);
	var thisY = (y*scale/5)+(scale*2);
	ctx.beginPath();
	ctx.arc(thisX, thisY, size, 0, 2 * Math.PI);
	ctx.fillStyle = color;
	ctx.fill();
}
var Prediction = []
function rebuildFrequency(factor=1){
	Prediction = []
	var amt = Samples.length
	for(var i = 0; i < amt;i++){
		var bucket = 0
		for(var j = 0;j<GoodFrequencies.length;j++){
			bucket+=Math.sin(GoodFrequencies[j][0]*((i/amt)+(GoodFrequencies[j][1][1]/180))*(2*Math.PI))*(GoodFrequencies[j][1][0])
		}
		bucket=(bucket*factor)
		Prediction.push(bucket+average)
	}
	repaintFrequency(0)
}

function repaintFrequency(mode = 2, showPrediction = true){	
	ctx.fillStyle = "#000000";
	ctx.fillRect(0, 0, canvas.width, canvas.height)
	for(var i =0;i<Samples.length;i++){
		ctx.fillStyle = "rgb(0,255,0)";
		if(i+1<Prediction.length && mode==1){
			var difference = Prediction[i]-Prediction[i+1]
			if(difference==0){		
				ctx.fillStyle = "rgb(0,255,0)";			
			}
			else if (difference>0){
				ctx.fillStyle = "rgb(0,64,196)";
			}
			else{
				ctx.fillStyle = "rgb(255,64,0)";
				
			}
		}
		var difference = 0
		if(i+1<Prediction.length && mode==2){
			var predictedSign = Math.sign(Prediction[i]-Prediction[i+1])
			var actualSign = Math.sign(Samples[i]-Samples[i+1])
			var difference = Math.abs((Prediction[i])-(Samples[i]))
			var sign = Math.sign((Prediction[i])-(Samples[i]))
			ctx.fillStyle = "rgb("+Math.round(Math.min((difference*32)+32,255))+","+Math.round(255-Math.max(0,Math.min((difference*32),255)))+",00)";
			if(Prediction[i]>Samples[i]){
				ctx.fillStyle = "rgb(00,"+Math.round(255-Math.min((difference*32),255))+","+Math.round(Math.min((difference*32)+32,255))+")";
				
			}
		}
		ctx.fillRect((i*10),canvas.height-(Samples[i]*20), 10, Samples[i]*20)
		if(Prediction[i]>Samples[i]){
			ctx.fillStyle = "#ddccff";
			
		}
		else{
			ctx.fillStyle = "#220033";
			
		}
		ctx.fillStyle="#F00"
		ctx.fillRect((i*10),canvas.height-(Prediction[i]*20), 10, 5)
		ctx.fillStyle="#FFFFFF"
		ctx.fillRect((i*10),canvas.height-(average*20), 10, 2)
	}
	drawPredictionLine()
}

function drawPredictionLine(){
	
	for(var i =0;i<Samples.length;i++){
		if(Prediction.length>i+1){
			ctx.strokeStyle = "#AA00bb";
			
			ctx.beginPath(); // Start a new path
			ctx.moveTo((i*10)+5, canvas.height-(Prediction[i]*20)); // Move the pen to (30, 50)
			ctx.lineTo(((i+1)*10)+5, canvas.height-(Prediction[i+1]*20)); // Draw a line to (150, 100)
			ctx.stroke(); // Render the path
			
			ctx.beginPath(); // Start a new path
			ctx.moveTo((i*10)+5, canvas.height-1-(Prediction[i]*20)); // Move the pen to (30, 50)
			ctx.lineTo(((i+1)*10)+5, canvas.height-1-(Prediction[i+1]*20)); // Draw a line to (150, 100)
			ctx.stroke(); // Render the path
			
			ctx.beginPath(); // Start a new path
			ctx.moveTo((i*10)+5, canvas.height+1-(Prediction[i]*20)); // Move the pen to (30, 50)
			ctx.lineTo(((i+1)*10)+5, canvas.height+1-(Prediction[i+1]*20)); // Draw a line to (150, 100)
			ctx.stroke(); // Render the path
			
			ctx.beginPath(); // Start a new path
			ctx.moveTo((i*10)+5, canvas.height-2-(Prediction[i]*20)); // Move the pen to (30, 50)
			ctx.lineTo(((i+1)*10)+5, canvas.height-2-(Prediction[i+1]*20)); // Draw a line to (150, 100)
			ctx.stroke(); // Render the path
			
			ctx.beginPath(); // Start a new path
			ctx.moveTo((i*10)+5, canvas.height+2-(Prediction[i]*20)); // Move the pen to (30, 50)
			ctx.lineTo(((i+1)*10)+5, canvas.height+2-(Prediction[i+1]*20)); // Draw a line to (150, 100)
			ctx.stroke(); // Render the path
			
			ctx.beginPath(); // Start a new path
			ctx.moveTo((i*10)+5, canvas.height-3-(Prediction[i]*20)); // Move the pen to (30, 50)
			ctx.lineTo(((i+1)*10)+5, canvas.height-3-(Prediction[i+1]*20)); // Draw a line to (150, 100)
			ctx.stroke(); // Render the path
			
			ctx.beginPath(); // Start a new path
			ctx.moveTo((i*10)+5, canvas.height+3-(Prediction[i]*20)); // Move the pen to (30, 50)
			ctx.lineTo(((i+1)*10)+5, canvas.height+3-(Prediction[i+1]*20)); // Draw a line to (150, 100)
			ctx.stroke(); // Render the path
			ctx.strokeStyle = "";
			
			ctx.strokeStyle = "#111";
			
			ctx.beginPath(); // Start a new path
			ctx.moveTo((i*10)+5, canvas.height-4-(Prediction[i]*20)); // Move the pen to (30, 50)
			ctx.lineTo(((i+1)*10)+5, canvas.height-4-(Prediction[i+1]*20)); // Draw a line to (150, 100)
			ctx.stroke(); // Render the path
			
			ctx.beginPath(); // Start a new path
			ctx.moveTo((i*10)+5, canvas.height+4-(Prediction[i]*20)); // Move the pen to (30, 50)
			ctx.lineTo(((i+1)*10)+5, canvas.height+4-(Prediction[i+1]*20)); // Draw a line to (150, 100)
			ctx.stroke(); // Render the path
			ctx.beginPath(); // Start a new path
			ctx.moveTo((i*10)+5, canvas.height-5-(Prediction[i]*20)); // Move the pen to (30, 50)
			ctx.lineTo(((i+1)*10)+5, canvas.height-5-(Prediction[i+1]*20)); // Draw a line to (150, 100)
			ctx.stroke(); // Render the path
			
			ctx.beginPath(); // Start a new path
			ctx.moveTo((i*10)+5, canvas.height+5-(Prediction[i]*20)); // Move the pen to (30, 50)
			ctx.lineTo(((i+1)*10)+5, canvas.height+5-(Prediction[i+1]*20)); // Draw a line to (150, 100)
			ctx.stroke(); // Render the path
			
			ctx.strokeStyle = "#b800cb";	
			
			ctx.beginPath(); // Start a new path
			ctx.moveTo((i*10)+5, canvas.height-(Prediction[i]*20)); // Move the pen to (30, 50)
			ctx.lineTo(((i+1)*10)+5, canvas.height-(Prediction[i+1]*20)); // Draw a line to (150, 100)
			ctx.stroke(); // Render the path
						
		}
	}
}
document.getElementById("results").innerHTML+=""+Samples.toString()+"<br>"
GetAverage()
stepFrequency();
</script>
