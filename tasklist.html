<!doctype html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Bootstrap demo</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
  </head>
  <body  onload="loadTasks()">
	<div class="bd-example m-0 border-0">
		<!----
		<table><tr class="alert alert-primary alert-dismissible fade show" role="alert"  style="height:32pt;"><td>
			  A simple primary alert with <a href="#" class="alert-link">an example link</a>. Give it a click if you like.
			</td><td>
			  Time to start
			</td>
			<td><p class="spacer" style="width:40px"></p></td>
			<td>
			 <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close" style="top:-8px;right:-8px;"></button>
			</td></tr></table>
			---->
		<!----
		<div class="list-group">
			  <a class="list-group-item list-group-item-action list-group-item-primary">A simple primary list group item</a>
			  <a class="list-group-item list-group-item-action list-group-item-info">A simple info list group item</a>
			</div>
		</div>
			---->
		<div class="list-group" id="checklist">          
		</div>
		<div style="width:200px;margin-right:auto;margin-left:auto;padding:0px;height:100px;;">
		<div class="list-group-item list-group-item-action list-group-item-info stockbuddybutton" onclick="document.getElementById('additiondiv').style.display='block';document.getElementById('uid').value=new Date().getTime()">Add</div>
		<div class="list-group-item list-group-item-action list-group-item-info stockbuddybutton" >Manage</div>
		</div>
    </div>
	<div  id ="additiondiv"  class="addition">
		<table id ="additiontable" class="addition">
			<tr style="display:none">
				<td class="sbcol1">UID</td>
				<td class="sbcol2"><input type="textbox" id="uid" /></td>
			</tr>
			<tr>
				<td class="sbcol1">Task</td>
				<td class="sbcol2"><input type="textbox" id="task" /></td>
			</tr>
			<tr>
				<td class="sbcol1">Start Time</td>
				<td class="sbcol2"><input type="time" id="starttime"/></td>
			</tr>
			<tr>
				<td class="sbcol1">End Time</td>
				<td class="sbcol2"><input type="time" id="endtime" /></td>
			</tr>
			<tr>
				<td class="sbcol1">Label</td>
				<td class="sbcol2"><input type="textbox" id="category" /></td>
			</tr>
		</table>
		<div style="width:200px;margin-right:auto;margin-left:auto;padding:0px;height:100px;;">
			<div class="list-group-item list-group-item-action list-group-item-info stockbuddybutton" onclick="addTask()">Add</div>
			<div class="list-group-item list-group-item-action list-group-item-danger stockbuddybutton" onclick="clear_addTask()">Cancel</div>
		</div>
		</div>
	<style>
	.stockbuddybutton {
		display:block;
		width:100px;
		margin:0px;
		float:left;
		text-align:center;
		height:100px;
		line-height:100px;
		cursor: pointer;
	}
	.sbcol2 {
		text-align:right;
	}
	#additiondiv{
		display:none
	}
	.addition {
		width:300px;
		margin:auto;
		padding-top:36px;
	}
	</style>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.min.js" integrity="sha384-BBtl+eGJRgqQAUMxJ7pMwbEyER4l1g+O15P+16Ep7Q9Q+zqX6gSbd85u4mG4QzX+" crossorigin="anonymous"></script>
	<script  type="text/javascript">	
	
	const checklistTemplate = '<div class="list-group-item list-group-item-action">A simple primary list group item</div>'
	
	const tasks = [];
	
	class StockBuddyTask {
		constructor(text,starttime,endtime,label,state,creationstamp=new Date().getTime(),parent=null) {
			if(text!=""){
				this.text = text;
				this.starttime = starttime;
				this.endtime = endtime;
				this.label = new StockBuddyLabelStyle(label);
				this.state=state ;
				tasks.push(this);
				this.subtasks=[];
				this.parent=parent;
				if(creationstamp!=0){
					this.creationstamp=creationstamp
				}else{
					this.creationstamp=new Date().getTime()				
				}
			}
		}
		serialize(){
			this.state=this.checkbox.value
			return JSON.stringify(this, ["text","starttime","endtime","label","state","style","creationstamp"])
		}
		static deserialize(string){
			return JSON.parse(string);
		}
		updatePrio(){
			var score  = 2;
			var date = new Date()
			var timestring  = date.getHours()+":"+date.getMinutes()
				this.label.style=StockBuddyLabelStyle.styles[1]
			if(this.state){
				this.label.style=StockBuddyLabelStyle.styles[0]
				return
			}
			if(this.starttime ==""){
			}
			else if(this.starttime >timestring){
				score+=-1
			}
			if(this.endtime ==""){
			}
			else if(this.endtime < timestring){
				score+=2
			}
			this.label.style=StockBuddyLabelStyle.styles[score]			
		}
	}
	class StockBuddyLabelStyle {
	  static styles = ["list-group-item-secondary","list-group-item-light","list-group-item-success","list-group-item-warning","list-group-item-danger"]
	  constructor(label) {
		if(typeof label === 'string'){
			this.text = label;
			this.style = "list-group-item-primary"
			
				//"list-group-item-danger"
				//"list-group-item-warning"
				//"list-group-item-success"
		}
		else{
			this.text = label.text;
			this.style = label.style;		
		}
	  }
	}
	function displayTasks(){	
		document.getElementById("checklist").innerHTML=""
		var i = 0
		tasks.forEach((task) => {
			 task.div = document.getElementById("checklist").appendChild(document.createElement("div"))
			 task.div.id="task:"+i+":"+task.creationstamp
			 task.div.style.padding="5px"
			 task.checkdiv = task.div.appendChild(document.createElement("div"))
			 task.checkdiv.className = "form-check form-switch";
			 task.checkdiv.style.padding="5px"
			 task.checkdiv.style.float="left"
			 task.checkbox = task.checkdiv.appendChild(document.createElement("input"))
			 task.checkbox.setAttribute("type",'checkbox')
			 task.checkbox.setAttribute("role",'switch')
			 task.checkbox.className = "form-check-input";
			 task.checkbox.style.margin="5px"
			 task.checkbox.checked=task.state
			 task.checkbox.onclick = Function(`
				tasks[parseInt(("`+task.div.id+`").split(':')[1])].state = document.getElementById("`+task.div.id+`").getElementsByTagName("input")[0].checked;
				saveTasks()
				displayTasks()
			 `)
			 task.tasktext=task.checkdiv.appendChild(document.createElement("span"))
			 task.tasktext.style.display="inline-block"
			 task.tasktext.style.width="auto"
			 task.tasktext.innerText=task.text
			 task.taskrighthand=task.div.appendChild(document.createElement("div"))
			 task.taskstart=task.taskrighthand.appendChild(document.createElement("div"))
			 task.taskstart.style.display="inline-block"
			 task.taskstart.style.width="50px"
			 task.taskstart.innerText=task.starttime
			 task.taskend=task.taskrighthand.appendChild(document.createElement("div"))
			 task.taskend.style.display="inline-block"
			 task.taskend.style.width="50px"
			 task.taskend.innerText=task.endtime
			 task.taskdelete=task.taskrighthand.appendChild(document.createElement("div"))
			 task.taskdelete.style.display="inline-block"
			 task.taskdelete.style.width="80px"
			 task.taskdelete.innerText="Delete"
			 task.taskdelete.className = "list-group-item list-group-item-action list-group-item-danger";
			 task.taskdelete.setAttribute("state",false)
			 task.taskdelete.onclick = Function(`
				tasks.splice(parseInt(("`+task.div.id+`").split(':')[1]), 1)
				saveTasks()
				displayTasks()
			 `)
			 task.taskrighthand.style.float="right"
			 task.updatePrio()
			 task.div.className = "list-group-item list-group-item-action "+task.label.style;
			 i++
			 
		});
	}
	
	function clear_addTask(){
		
		document.getElementById("task").value=""
		document.getElementById("starttime").value=""
		document.getElementById("endtime").value=""
		document.getElementById("category").value=""
		document.getElementById('additiondiv').style.display='none'
	}
	
	function addTask(){
		new StockBuddyTask(
			document.getElementById("task").value,
			document.getElementById("starttime").value,
			document.getElementById("endtime").value,
			document.getElementById("category").value,
			false,
			document.getElementById("uid").value
		)
		clear_addTask()
		displayTasks()
		saveTasks()
	}
	
	function loadTasks(){
		var loadedCodes = JSON.parse(localStorage.getItem("StockBuddy_Tasklist"));
		if(loadedCodes  != null){
			loadedCodes.forEach((code) => {
				//text,starttime,endtime,label,state
				new StockBuddyTask(
					code.text,
					code.starttime,
					code.endtime,
					code.label,
					code.state,
					code.creationstamp
				)
			});
		}
		displayTasks()
	}
	function saveTasks(){
		localStorage.setItem("StockBuddy_Tasklist",JSON.stringify(tasks));
	}
	
	setInterval(() => {
		displayTasks();
	  }, 500);
	</script>
  </body>
</html>
